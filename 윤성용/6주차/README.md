# Next.js Pre-rendering 이해해보기

Next.js에서는 Pre-rendering이라는 중요한 기능이 있다.

Pre-rendering은 말 그대로 서버에서 먼저 HTML을 그려준다는것을 말한다.

### 어떤 문제를 해결하려 했을까?

기존 React와 같은 SPA에서는 보통 빈 HTML을 서버에 요청을 받고, 번들링된 자바스크립트를 받아 브라우저에서 화면을 그려준다.
이것을 우리가 익숙하게 알고 있는 CSR 개념이다.

CSR의 동작 순서는 아래와 같다.
1. 유저가 페이지를 요청
2. 브라우저는 서버에 자원을 요청
3. 브라우저는 서버에게 빈 HTML을 받고 화면을 구성 (빈 화면)
4. 추가로 JS Bundle도 브라우저에 전달 (HTTP 통신이기에 1번씩 요청)
5. 브라우저에서 전달 받은 JS 실행
6. 유저에게 컨텐츠가 노출 (FCP, TTI 완료)
7. 이후 서버에 자원 요청 없이 사용 가능

위 동작 순서를 통해 확인해 보면 CSR에 대한 장점과 단점은 명확하다.

장점으로는 초기 요청 후에는 페이지 변환이나 동작이 빠른것이다. 그러한 이유는 이미 번들링된 JS를 통해 추가 서버에 요청 없이 화면을 그리기 때문이다.

반대로 단점은 초기 요청이 길어 FCP(First contentful paint)와 TTI(Time to Interactive)의 시간이 길고, 비어 있는 HTML을 요청 받기에 크롤러가 읽어갈 자료가 없어 SEO에도 취약점이 있다. (CSR도 크롤링이 가능하는 얘기가 있다.)

또한, JS 청크 파일이 크면 클 수록 랜더링하는 과정중 흰 화면(block time)이 노출될 수 있다.

Next.js는 이러한 CSR의 장단점을 모두 사용할 수 있게 Pre-rendering 도입하게 되었다.

### Pre-rendering

Pre-rendering의 동작 순서는 아래와 같다.
1. 유저가 페이지를 요청
2. 브라우저는 서버에 자원을 요청
3. 서버는 서버에서 JS를 실행 하여 HTML을 만들고 브라우저에게 전달
4. 브라우저는 받은 HTML을 통해 화면을 구성 (FCP 완료)
5. 추가로 JS Bundle도 브라우저에게 전달
6. 브라우저는 받은 JS Bundle과 이전 전달 받은 HTML에 Hydration을 진행 (TTI 완료)




Pre-rendering 종류가 여러개이지만 HTML을 언제 생성하느냐의